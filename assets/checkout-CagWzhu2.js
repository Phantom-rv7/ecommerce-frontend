import{b as C,u as I,r as p,T as w,l as R,Q as N,j as a,V as o,U as O,W as S}from"./index-CC-10JTR.js";const T=()=>{const m=C(),u=I(),[y,c]=p.useState(!1),[g]=w(),{userReducer:{user:r},cartReducer:{cartItems:i,shippingInfo:t,subtotal:x,tax:j,discount:z,shippingCharges:v,total:d}}=R(e=>e),{refetch:_}=N((r==null?void 0:r._id)??"");p.useEffect(()=>{const e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,document.body.appendChild(e)},[]),p.useEffect(()=>{(i.length===0||!t.address)&&u("/cart")},[]);const h=(e="")=>e.replace(/[^\w\s@.]/gi,"").trim(),P=async()=>{if(!r||i.length===0||!t.address){o.error("Missing checkout information");return}try{c(!0);const n=await(await fetch("https://ecom-25-backend.onrender.com/api/v1/payment/create-order",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({amount:d})})).json(),b={key:"rzp_test_RBxKsd8n2TapUw",amount:n.amount,currency:n.currency,name:"Retro Revival",description:"Order Payment",order_id:n.id,handler:async l=>{var f;const k={razorpayPaymentId:l.razorpay_payment_id,razorpayOrderId:l.razorpay_order_id,razorpaySignature:l.razorpay_signature,orderItems:i.map(s=>({name:s.name,price:s.price,quantity:s.quantity,productId:s.productId})),shippingInfo:{address:t.address,city:t.city,state:t.state,pinCode:t.pinCode,phnumber:t.phnumber},user:r._id,subtotal:x,tax:j,discount:z,shippingCharges:v,total:d};try{const s=await g(k).unwrap();o.success(s.message),m(O()),_(),m(S.util.invalidateTags(["orders"])),u("/orders")}catch(s){o.error(((f=s==null?void 0:s.data)==null?void 0:f.message)||"Payment verification failed")}finally{c(!1)}},prefill:{name:h(r.name),email:h(r.email),contact:/^\d{10}$/.test(t.phnumber)?t.phnumber:""},theme:{color:"#3399cc"},modal:{ondismiss:()=>{o("Payment cancelled"),c(!1)}}};new window.Razorpay(b).open()}catch(e){o.error((e==null?void 0:e.message)||"Failed to create Razorpay order"),c(!1)}};return a.jsxs("div",{className:"checkout-container",children:[a.jsx("h2",{children:"Complete Your Payment"}),a.jsx("div",{className:"order-summary",children:i.map((e,n)=>a.jsxs("div",{className:"order-item",children:[a.jsx("img",{src:e.photo,alt:e.name,className:"order-item__image"}),a.jsxs("div",{className:"order-item__details",children:[a.jsx("h4",{style:{fontFamily:"monospace"},children:e.name}),a.jsxs("p",{style:{fontFamily:"monospace"},children:[a.jsx("strong",{children:"Size: "}),e.size]}),a.jsxs("p",{style:{fontFamily:"monospace"},children:[a.jsx("strong",{children:"Quantity: "}),e.quantity]}),a.jsxs("p",{style:{fontFamily:"monospace"},children:[a.jsx("strong",{children:"Delivery: "}),"8–10 days from Order Placed"]})]})]},n))}),a.jsx("button",{onClick:P,disabled:y,children:y?"Processing...":`Pay ₹${d}`})]})};export{T as default};
